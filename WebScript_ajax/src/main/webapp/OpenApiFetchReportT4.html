<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>지하철역 pm10</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <button id="btn">공공데이터 호출</button>
    <input id="input" type="text" />
    <div id="result"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
  <script type="text/javascript">
    const input = document.getElementById("input");
    const result = document.getElementById("result");
    const button = document.getElementById("btn");

    function createTable(arr) {
      const table = document.createElement("table");
      const tbody = document.createElement("tbody");

      arr.forEach((obj) => {
        const row = document.createElement("tr");
        Object.values(obj).forEach((val) => {
          const td = document.createElement("td");
          td.textContent = val;
          row.appendChild(td);
        });
        tbody.appendChild(row);
      });

      table.setAttribute("class", "table table-striped");
      table.appendChild(tbody);

      return table;
    }

    function fetchData(numOfRows = 20) {
      const endPoint = `https://apis.data.go.kr/6260000/IndoorAirQuality/getIndoorAirQualityByItem?serviceKey=Bf74XPYRYshYcbMIZ%2FO6YSTapAkHcR5gHdf2hBl2NB286c0KR2e%2Flc8HSG6N6xnB%2BjUEDfEuUEVYGFQK2%2B1BSA%3D%3D&pageNo=1&numOfRows=${numOfRows}&resultType=JSON&controlnumber=2024101518`;

      fetch(endPoint)
        .then((res) => res.json())
        .then((data) => {
          console.log("받은 데이터:", data);
          const arr = data.response.body.items.item;

          result.innerHTML = "";
          result.appendChild(createTable(arr));
        })
        .catch((err) => console.error(err));
    }

    button.addEventListener("click", () => {
      const value = input.value || 20;
      fetchData(value);
    });
  </script>
</html>